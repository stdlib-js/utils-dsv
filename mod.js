// Copyright (c) 2023 The Stdlib Authors. License is Apache-2.0: http://www.apache.org/licenses/LICENSE-2.0
/// <reference types="./mod.d.ts" />
var e="function"==typeof Object.defineProperty?Object.defineProperty:null;var t=Object.defineProperty;function i(e){return"number"==typeof e}function r(e){var t,i="";for(t=0;t<e;t++)i+="0";return i}function n(e,t,i){var n=!1,s=t-e.length;return s<0||(function(e){return"-"===e[0]}(e)&&(n=!0,e=e.substr(1)),e=i?e+r(s):r(s)+e,n&&(e="-"+e)),e}var s=String.prototype.toLowerCase,a=String.prototype.toUpperCase;function o(e){var t,r,o;switch(e.specifier){case"b":t=2;break;case"o":t=8;break;case"x":case"X":t=16;break;default:t=10}if(r=e.arg,o=parseInt(r,10),!isFinite(o)){if(!i(r))throw new Error("invalid integer. Value: "+r);o=0}return o<0&&("u"===e.specifier||10!==t)&&(o=4294967295+o+1),o<0?(r=(-o).toString(t),e.precision&&(r=n(r,e.precision,e.padRight)),r="-"+r):(r=o.toString(t),o||e.precision?e.precision&&(r=n(r,e.precision,e.padRight)):r="",e.sign&&(r=e.sign+r)),16===t&&(e.alternate&&(r="0x"+r),r=e.specifier===a.call(e.specifier)?a.call(r):s.call(r)),8===t&&e.alternate&&"0"!==r.charAt(0)&&(r="0"+r),r}function c(e){return"string"==typeof e}var _=Math.abs,u=String.prototype.toLowerCase,p=String.prototype.toUpperCase,h=String.prototype.replace,d=/e\+(\d)$/,l=/e-(\d)$/,f=/^(\d+)$/,g=/^(\d+)e/,w=/\.0$/,v=/\.0*e/,m=/(\..*[^0])0*e/;function k(e){var t,r,n=parseFloat(e.arg);if(!isFinite(n)){if(!i(e.arg))throw new Error("invalid floating-point number. Value: "+r);n=e.arg}switch(e.specifier){case"e":case"E":r=n.toExponential(e.precision);break;case"f":case"F":r=n.toFixed(e.precision);break;case"g":case"G":_(n)<1e-4?((t=e.precision)>0&&(t-=1),r=n.toExponential(t)):r=n.toPrecision(e.precision),e.alternate||(r=h.call(r,m,"$1e"),r=h.call(r,v,"e"),r=h.call(r,w,""));break;default:throw new Error("invalid double notation. Value: "+e.specifier)}return r=h.call(r,d,"e+0$1"),r=h.call(r,l,"e-0$1"),e.alternate&&(r=h.call(r,f,"$1."),r=h.call(r,g,"$1.e")),n>=0&&e.sign&&(r=e.sign+r),r=e.specifier===p.call(e.specifier)?p.call(r):u.call(r)}function b(e){var t,i="";for(t=0;t<e;t++)i+=" ";return i}function y(e,t,i){var r=t-e.length;return r<0?e:e=i?e+b(r):b(r)+e}var S=String.fromCharCode,x=isNaN,q=Array.isArray;function E(e){var t={};return t.specifier=e.specifier,t.precision=void 0===e.precision?1:e.precision,t.width=e.width,t.flags=e.flags||"",t.mapping=e.mapping,t}function L(e){var t,i,r,s,a,_,u,p,h;if(!q(e))throw new TypeError("invalid argument. First argument must be an array. Value: `"+e+"`.");for(_="",u=1,p=0;p<e.length;p++)if(c(r=e[p]))_+=r;else{if(t=void 0!==r.precision,!(r=E(r)).specifier)throw new TypeError("invalid argument. Token is missing `specifier` property. Index: `"+p+"`. Value: `"+r+"`.");for(r.mapping&&(u=r.mapping),i=r.flags,h=0;h<i.length;h++)switch(s=i.charAt(h)){case" ":r.sign=" ";break;case"+":r.sign="+";break;case"-":r.padRight=!0,r.padZeros=!1;break;case"0":r.padZeros=i.indexOf("-")<0;break;case"#":r.alternate=!0;break;default:throw new Error("invalid flag: "+s)}if("*"===r.width){if(r.width=parseInt(arguments[u],10),u+=1,x(r.width))throw new TypeError("the argument for * width at position "+u+" is not a number. Value: `"+r.width+"`.");r.width<0&&(r.padRight=!0,r.width=-r.width)}if(t&&"*"===r.precision){if(r.precision=parseInt(arguments[u],10),u+=1,x(r.precision))throw new TypeError("the argument for * precision at position "+u+" is not a number. Value: `"+r.precision+"`.");r.precision<0&&(r.precision=1,t=!1)}switch(r.arg=arguments[u],r.specifier){case"b":case"o":case"x":case"X":case"d":case"i":case"u":t&&(r.padZeros=!1),r.arg=o(r);break;case"s":r.maxWidth=t?r.precision:-1;break;case"c":if(!x(r.arg)){if((a=parseInt(r.arg,10))<0||a>127)throw new Error("invalid character code. Value: "+r.arg);r.arg=x(a)?String(r.arg):S(a)}break;case"e":case"E":case"f":case"F":case"g":case"G":t||(r.precision=6),r.arg=k(r);break;default:throw new Error("invalid specifier: "+r.specifier)}r.maxWidth>=0&&r.arg.length>r.maxWidth&&(r.arg=r.arg.substring(0,r.maxWidth)),r.padZeros?r.arg=n(r.arg,r.width||r.precision,r.padRight):r.width&&(r.arg=y(r.arg,r.width,r.padRight)),_+=r.arg||"",u+=1}return _}var I=/%(?:([1-9]\d*)\$)?([0 +\-#]*)(\*|\d+)?(?:(\.)(\*|\d+)?)?[hlL]?([%A-Za-z])/g;function C(e){var t={mapping:e[1]?parseInt(e[1],10):void 0,flags:e[2],width:e[3],precision:e[5],specifier:e[6]};return"."===e[4]&&void 0===e[5]&&(t.precision="1"),t}function R(e){var t,i,r,n;for(i=[],n=0,r=I.exec(e);r;)(t=e.slice(n,I.lastIndex-r[0].length)).length&&i.push(t),i.push(C(r)),n=I.lastIndex,r=I.exec(e);return(t=e.slice(n)).length&&i.push(t),i}function W(e){return"string"==typeof e}function N(e){var t,i,r;if(!W(e))throw new TypeError(N("invalid argument. First argument must be a string. Value: `%s`.",e));for(t=R(e),(i=new Array(arguments.length))[0]=t,r=1;r<i.length;r++)i[r]=arguments[r];return L.apply(null,i)}var O,V=Object.prototype,F=V.toString,A=V.__defineGetter__,j=V.__defineSetter__,T=V.__lookupGetter__,D=V.__lookupSetter__;O=function(){try{return e({},"x",{}),!0}catch(e){return!1}}()?t:function(e,t,i){var r,n,s,a;if("object"!=typeof e||null===e||"[object Array]"===F.call(e))throw new TypeError(N("invalid argument. First argument must be an object. Value: `%s`.",e));if("object"!=typeof i||null===i||"[object Array]"===F.call(i))throw new TypeError(N("invalid argument. Property descriptor must be an object. Value: `%s`.",i));if((n="value"in i)&&(T.call(e,t)||D.call(e,t)?(r=e.__proto__,e.__proto__=V,delete e[t],e[t]=i.value,e.__proto__=r):e[t]=i.value),s="get"in i,a="set"in i,n&&(s||a))throw new Error("invalid argument. Cannot specify one or more accessors and a value or writable attribute in the property descriptor.");return s&&A&&A.call(e,t,i.get),a&&j&&j.call(e,t,i.set),e};var P=O;var $="function"==typeof Object.defineProperty?Object.defineProperty:null;var Q,B=Object.defineProperty,G=Object.prototype,U=G.toString,Z=G.__defineGetter__,z=G.__defineSetter__,M=G.__lookupGetter__,X=G.__lookupSetter__;Q=function(){try{return $({},"x",{}),!0}catch(e){return!1}}()?B:function(e,t,i){var r,n,s,a;if("object"!=typeof e||null===e||"[object Array]"===U.call(e))throw new TypeError("invalid argument. First argument must be an object. Value: `"+e+"`.");if("object"!=typeof i||null===i||"[object Array]"===U.call(i))throw new TypeError("invalid argument. Property descriptor must be an object. Value: `"+i+"`.");if((n="value"in i)&&(M.call(e,t)||X.call(e,t)?(r=e.__proto__,e.__proto__=G,delete e[t],e[t]=i.value,e.__proto__=r):e[t]=i.value),s="get"in i,a="set"in i,n&&(s||a))throw new Error("invalid argument. Cannot specify one or more accessors and a value or writable attribute in the property descriptor.");return s&&Z&&Z.call(e,t,i.get),a&&z&&z.call(e,t,i.set),e};var H=Q;function J(e){if(e.__esModule)return e;var t=e.default;if("function"==typeof t){var i=function e(){if(this instanceof e){var i=[null];i.push.apply(i,arguments);var r=Function.bind.apply(t,i);return new r}return t.apply(this,arguments)};i.prototype=t.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(e).forEach((function(t){var r=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(i,t,r.get?r:{enumerable:!0,get:function(){return e[t]}})})),i}var K=J(Object.freeze({__proto__:null,default:()=>()=>{}}));function Y(e,t,i){H(e,t,{configurable:!1,enumerable:!1,writable:!1,value:i})}var ee=Boolean;function te(e){return"number"==typeof e}function ie(e){var t,i="";for(t=0;t<e;t++)i+="0";return i}function re(e,t,i){var r=!1,n=t-e.length;return n<0||(function(e){return"-"===e[0]}(e)&&(r=!0,e=e.substr(1)),e=i?e+ie(n):ie(n)+e,r&&(e="-"+e)),e}var ne=String.prototype.toLowerCase,se=String.prototype.toUpperCase;function ae(e){var t,i,r;switch(e.specifier){case"b":t=2;break;case"o":t=8;break;case"x":case"X":t=16;break;default:t=10}if(i=e.arg,r=parseInt(i,10),!isFinite(r)){if(!te(i))throw new Error("invalid integer. Value: "+i);r=0}return r<0&&("u"===e.specifier||10!==t)&&(r=4294967295+r+1),r<0?(i=(-r).toString(t),e.precision&&(i=re(i,e.precision,e.padRight)),i="-"+i):(i=r.toString(t),r||e.precision?e.precision&&(i=re(i,e.precision,e.padRight)):i="",e.sign&&(i=e.sign+i)),16===t&&(e.alternate&&(i="0x"+i),i=e.specifier===se.call(e.specifier)?se.call(i):ne.call(i)),8===t&&e.alternate&&"0"!==i.charAt(0)&&(i="0"+i),i}function oe(e){return"string"==typeof e}var ce=Math.abs,_e=String.prototype.toLowerCase,ue=String.prototype.toUpperCase,pe=String.prototype.replace,he=/e\+(\d)$/,de=/e-(\d)$/,le=/^(\d+)$/,fe=/^(\d+)e/,ge=/\.0$/,we=/\.0*e/,ve=/(\..*[^0])0*e/;function me(e){var t,i,r=parseFloat(e.arg);if(!isFinite(r)){if(!te(e.arg))throw new Error("invalid floating-point number. Value: "+i);r=e.arg}switch(e.specifier){case"e":case"E":i=r.toExponential(e.precision);break;case"f":case"F":i=r.toFixed(e.precision);break;case"g":case"G":ce(r)<1e-4?((t=e.precision)>0&&(t-=1),i=r.toExponential(t)):i=r.toPrecision(e.precision),e.alternate||(i=pe.call(i,ve,"$1e"),i=pe.call(i,we,"e"),i=pe.call(i,ge,""));break;default:throw new Error("invalid double notation. Value: "+e.specifier)}return i=pe.call(i,he,"e+0$1"),i=pe.call(i,de,"e-0$1"),e.alternate&&(i=pe.call(i,le,"$1."),i=pe.call(i,fe,"$1.e")),r>=0&&e.sign&&(i=e.sign+i),i=e.specifier===ue.call(e.specifier)?ue.call(i):_e.call(i)}function ke(e){var t,i="";for(t=0;t<e;t++)i+=" ";return i}function be(e,t,i){var r=t-e.length;return r<0?e:e=i?e+ke(r):ke(r)+e}var ye=String.fromCharCode,Se=isNaN,xe=Array.isArray;function qe(e){var t={};return t.specifier=e.specifier,t.precision=void 0===e.precision?1:e.precision,t.width=e.width,t.flags=e.flags||"",t.mapping=e.mapping,t}function Ee(e){var t,i,r,n,s,a,o,c,_;if(!xe(e))throw new TypeError("invalid argument. First argument must be an array. Value: `"+e+"`.");for(a="",o=1,c=0;c<e.length;c++)if(oe(r=e[c]))a+=r;else{if(t=void 0!==r.precision,!(r=qe(r)).specifier)throw new TypeError("invalid argument. Token is missing `specifier` property. Index: `"+c+"`. Value: `"+r+"`.");for(r.mapping&&(o=r.mapping),i=r.flags,_=0;_<i.length;_++)switch(n=i.charAt(_)){case" ":r.sign=" ";break;case"+":r.sign="+";break;case"-":r.padRight=!0,r.padZeros=!1;break;case"0":r.padZeros=i.indexOf("-")<0;break;case"#":r.alternate=!0;break;default:throw new Error("invalid flag: "+n)}if("*"===r.width){if(r.width=parseInt(arguments[o],10),o+=1,Se(r.width))throw new TypeError("the argument for * width at position "+o+" is not a number. Value: `"+r.width+"`.");r.width<0&&(r.padRight=!0,r.width=-r.width)}if(t&&"*"===r.precision){if(r.precision=parseInt(arguments[o],10),o+=1,Se(r.precision))throw new TypeError("the argument for * precision at position "+o+" is not a number. Value: `"+r.precision+"`.");r.precision<0&&(r.precision=1,t=!1)}switch(r.arg=arguments[o],r.specifier){case"b":case"o":case"x":case"X":case"d":case"i":case"u":t&&(r.padZeros=!1),r.arg=ae(r);break;case"s":r.maxWidth=t?r.precision:-1;break;case"c":if(!Se(r.arg)){if((s=parseInt(r.arg,10))<0||s>127)throw new Error("invalid character code. Value: "+r.arg);r.arg=Se(s)?String(r.arg):ye(s)}break;case"e":case"E":case"f":case"F":case"g":case"G":t||(r.precision=6),r.arg=me(r);break;default:throw new Error("invalid specifier: "+r.specifier)}r.maxWidth>=0&&r.arg.length>r.maxWidth&&(r.arg=r.arg.substring(0,r.maxWidth)),r.padZeros?r.arg=re(r.arg,r.width||r.precision,r.padRight):r.width&&(r.arg=be(r.arg,r.width,r.padRight)),a+=r.arg||"",o+=1}return a}var Le=/%(?:([1-9]\d*)\$)?([0 +\-#]*)(\*|\d+)?(?:(\.)(\*|\d+)?)?[hlL]?([%A-Za-z])/g;function Ie(e){var t={mapping:e[1]?parseInt(e[1],10):void 0,flags:e[2],width:e[3],precision:e[5],specifier:e[6]};return"."===e[4]&&void 0===e[5]&&(t.precision="1"),t}function Ce(e){var t,i,r,n;for(i=[],n=0,r=Le.exec(e);r;)(t=e.slice(n,Le.lastIndex-r[0].length)).length&&i.push(t),i.push(Ie(r)),n=Le.lastIndex,r=Le.exec(e);return(t=e.slice(n)).length&&i.push(t),i}function Re(e){return"string"==typeof e}function We(e){var t,i,r;if(!Re(e))throw new TypeError(We("invalid argument. First argument must be a string. Value: `%s`.",e));for(t=Ce(e),(i=new Array(arguments.length))[0]=t,r=1;r<i.length;r++)i[r]=arguments[r];return Ee.apply(null,i)}function Ne(e){return"string"==typeof e}var Oe="function"==typeof Symbol&&"symbol"==typeof Symbol("foo");function Ve(){return Oe&&"symbol"==typeof Symbol.toStringTag}var Fe=Object.prototype.toString;var Ae=Object.prototype.hasOwnProperty;var je="function"==typeof Symbol?Symbol.toStringTag:"";var Te=Ve()?function(e){var t,i,r,n,s;if(null==e)return Fe.call(e);i=e[je],s=je,t=null!=(n=e)&&Ae.call(n,s);try{e[je]=void 0}catch(t){return Fe.call(e)}return r=Fe.call(e),t?e[je]=i:delete e[je],r}:function(e){return Fe.call(e)},De=String.prototype.valueOf;var Pe=Ve();function $e(e){return"object"==typeof e&&(e instanceof String||(Pe?function(e){try{return De.call(e),!0}catch(e){return!1}}(e):"[object String]"===Te(e)))}function Qe(e){return Ne(e)||$e(e)}Y(Qe,"isPrimitive",Ne),Y(Qe,"isObject",$e);var Be=/[-\/\\^$*+?.()|[\]{}]/g;function Ge(e){var t,i;if(!Ne(e))throw new TypeError(We("invalid argument. Must provide a regular expression string. Value: `%s`.",e));if("/"===e[0])for(i=e.length-1;i>=0&&"/"!==e[i];i--);return void 0===i||i<=0?e.replace(Be,"\\$&"):(t=(t=e.substring(1,i)).replace(Be,"\\$&"),e=e[0]+t+e.substring(i))}function Ue(e,t,i){return e.replace(t,i)}function Ze(){}function ze(e){throw e}function Me(){return{comment:"",delimiter:",",doublequote:!0,escape:"",ltrim:!1,maxRows:1e308,newline:"\r\n",onClose:Ze,onColumn:Ze,onComment:null,onError:ze,onRow:Ze,onSkip:null,onWarn:null,quote:'"',quoting:!0,rowBuffer:[],rtrim:!1,skip:"",skipBlankRows:!1,skipRow:null,strict:!0,trimComment:!0,whitespace:[" "]}}var Xe=["closed","comment","escape","error","field","init","invalid_quote_end","quote_end","quoted_escape","quoted_field","skip","skipped_comment","skipped_escape","skipped_field","skipped_invalid_quote_end","skipped_quote_end","skipped_quoted_escape","skipped_quoted_field"];var He=function(){var e,t;for(e={},t=0;t<Xe.length;t++)e[Xe[t]]=t;return e}(),Je=He.closed;var Ke=K("state:comment"),Ye=He.init;var et=He.error;function tt(e,t){return e<t?t:e}var it=K("state:escape"),rt=He.error,nt=He.field;var st=K("state:field"),at=He.escape,ot=He.field,ct=He.init,_t=He.quoted_field;var ut=K("state:init"),pt=He.comment,ht=He.field,dt=He.escape,lt=He.init,ft=He.quoted_field,gt=He.skip;var wt=K("state:invalid_quote_end"),vt=He.error,mt=He.field,kt=He.init;function bt(e,t){e._isWhitespace(e._qidx+1,e._cursor)?e._raiseWarning("INVALID_CLOSING_QUOTE")._rewind(e._cursor-e._qidx)._changeState(t):(wt("Error."),e._setErrorState("INVALID_CLOSING_QUOTE")._changeState(vt))}var yt=K("state:quote_end"),St=He.error,xt=He.field,qt=He.init,Et=He.invalid_quote_end,Lt=He.quoted_field;var It=K("state:quoted_escape"),Ct=He.error,Rt=He.quoted_field;var Wt=K("state:quoted_field"),Nt=He.quote_end,Ot=He.quoted_escape;var Vt=K("state:skip"),Ft=He.init,At=He.skip,jt=He.skipped_comment,Tt=He.skipped_field,Dt=He.skipped_escape,Pt=He.skipped_quoted_field;var $t=K("state:skipped_comment"),Qt=He.init;var Bt=K("state:skipped_escape"),Gt=He.skipped_field;var Ut=K("state:skipped_field"),Zt=He.init,zt=He.skipped_escape,Mt=He.skipped_field,Xt=He.skipped_quoted_field;var Ht=K("state:skipped_invalid_quote_end"),Jt=He.skipped_field,Kt=He.init;var Yt=K("state:skipped_quote_end"),ei=He.init,ti=He.skipped_field,ii=He.skipped_invalid_quote_end,ri=He.skipped_quoted_field;var ni=K("state:skipped_quoted_escape"),si=He.skipped_quoted_field;var ai=K("state:skipped_quoted_field"),oi=He.skipped_quote_end,ci=He.skipped_quoted_escape;var _i={closed:function(e){return function(){e._changeState(Je)}},comment:function(e){var t,i;return t=e._newlineLastIndex,i=e._newline,function(r){if(Ke("Char: %s",r),r===i[t]&&e._scan(i,t))return Ke("Newline."),void e._rewind(t)._changeState(Ye);e._push(r)}},escape:function(e){var t,i,r,n,s,a,o,c,_,u,p,h,d;return t=e._delimiterLastIndex,o=e._delimiter,i=e._newlineLastIndex,c=e._newline,r=e._commentLastIndex,_=e._comment,s=e._skipLastIndex,h=e._skip,n=e._escapeLastIndex,a=e._escapeLength,u=e._escape,p=e._strict,d=tt(tt(t,i),n),function(l){var f=e._cursor,g=e._eidx,w=f-g;if(it("Char: %s",l),w===t&&l===o[t]&&e._scan(o,t))return it("Delimiter."),void e._copyWithin(g-n,g+1,t)._rewind(a)._push(l)._changeState(nt);if(w===i&&l===c[i]&&e._scan(c,i))return it("Newline."),void e._copyWithin(g-n,g+1,i)._rewind(a)._push(l)._changeState(nt);if(w===n&&l===u[n]&&e._scan(u,n))return it("Escape."),void e._copyWithin(g-n,g+1,n)._rewind(a)._push(l)._changeState(nt);if(_&&f-r==0&&l===_[r]&&e._scan(_,r))return it("Comment."),void e._copyWithin(g-r,g+1,r)._rewind(a)._push(l)._changeState(nt);if(h&&f-s==0&&l===h[s]&&e._scan(h,s))return it("Skip."),void e._copyWithin(g-s,g+1,s)._rewind(a)._push(l)._changeState(nt);if(w>=d)return p?(it("Error."),void e._setErrorState("INVALID_ESCAPE")._changeState(rt)):(it("Escape sequence is not followed by a special character sequence."),void e._raiseWarning("INVALID_ESCAPE")._push(l)._changeState(nt));e._push(l)}},error:function(e){return function(){e._changeState(et)}},field:function(e){var t,i,r,n,s,a,o,c,_,u;return r=e._escapeLastIndex,c=e._escape,n=e._quoteLastIndex,u=e._quote,t=e._delimiterLastIndex,s=e._delimiter,i=e._newlineLastIndex,a=e._newline,o=e._quoting,_=e._strict,function(p){var h=e._cursor-e._cidx+1;if(st("Char: %s",p),p===c[r]&&e._scan(c,r))return st("Escape."),void e._push(p)._changeState(at);if(h-n==0&&p===u[n]&&e._scan(u,n))return o?(st("Quote."),void e._rewind(n)._changeState(_t)):void e._push(p);if(!1===_&&p===u[n]&&e._scan(u,n))return o&&e._isWhitespace(e._cidx,e._cursor-n)?(st("Quote."),void e._raiseWarning("INVALID_OPENING_QUOTE")._rewind(h)._changeState(_t)):void e._push(p);if(p===s[t]&&e._scan(s,t))return st("Delimiter."),void e._rewind(t)._changeState(ot);if(p===a[i]&&e._scan(a,i))return st("Newline."),void e._rewind(i)._changeState(ct);e._push(p)}},init:function(e){var t,i,r,n,s,a,o,c,_,u,p,h,d,l;return r=e._commentLastIndex,_=e._comment,a=e._skipLastIndex,l=e._skip,n=e._escapeLastIndex,p=e._escape,s=e._quoteLastIndex,d=e._quote,t=e._delimiterLastIndex,o=e._delimiter,i=e._newlineLastIndex,c=e._newline,u=e._quoting,h=e._strict,function(f){var g=e._cursor+1;if(ut("Char: %s",f),_&&g-r==0&&f===_[r]&&e._scan(_,r))return ut("Comment."),void e._rewind(r)._changeState(pt);if(l&&g-a==0&&f===l[a]&&e._scan(l,a))return ut("Skip."),void e._rewind(a)._changeState(gt);if(f===p[n]&&e._scan(p,n))return ut("Escape."),void e._push(f)._changeState(dt);if(g-s==0&&f===d[s]&&e._scan(d,s))return u?(ut("Quote."),void e._rewind(s)._changeState(ft)):void e._push(f);if(!1===h&&f===d[s]&&e._scan(d,s))return u&&e._isWhitespace(0,e._cursor-s)?(ut("Quote."),void e._raiseWarning("INVALID_OPENING_QUOTE")._rewind(g)._changeState(ft)):void e._push(f);if(f===o[t]&&e._scan(o,t))return ut("Delimiter."),void e._rewind(t)._changeState(ht);if(f===c[i]&&e._scan(c,i))return ut("Newline."),void e._rewind(i)._changeState(lt);e._push(f)}},invalid_quote_end:function(e){var t,i,r,n;return t=e._delimiterLastIndex,r=e._delimiter,i=e._newlineLastIndex,n=e._newline,function(s){if(wt("Char: %s",s),s===r[t]&&e._scan(r,t))return wt("Delimiter."),e._rewind(t),void bt(e,mt);if(s===n[i]&&e._scan(n,i))return wt("Newline."),e._rewind(i),void bt(e,kt);e._push(s)}},quote_end:function(e){var t,i,r,n,s,a,o,c,_;return t=e._delimiterLastIndex,s=e._delimiter,i=e._newlineLastIndex,a=e._newline,r=e._quoteLastIndex,c=e._quote,n=e._doublequote,o=e._strict,_=tt(tt(t,i),r),function(u){if(yt("Char: %s",u),n&&u===c[r]&&e._scan(c,r))return yt("Double quote."),void e._push(u)._changeState(Lt);if(u===s[t]&&e._scan(s,t))return yt("Delimiter."),void e._rewind(t)._changeState(xt);if(u===a[i]&&e._scan(a,i))return yt("Newline."),void e._rewind(i)._changeState(qt);if(e._cursor-e._qidx>=_)return o?(yt("Error."),void e._setErrorState("INVALID_CLOSING_QUOTE")._changeState(St)):(yt("Invalid closing quote."),void e._push(u)._changeState(Et));e._push(u)}},quoted_escape:function(e){var t,i,r,n,s;return i=e._quoteLastIndex,s=e._quote,t=e._escapeLastIndex,r=e._escapeLength,n=e._strict,function(a){var o=e._cursor,c=e._eidx,_=o-c;if(It("Char: %s",a),_===i&&a===s[i]&&e._scan(s,i))return It("Quote."),void e._copyWithin(c-t,c+1,i)._rewind(r)._push(a)._changeState(Rt);if(_>=i)return n?(It("Error."),void e._setErrorState("INVALID_QUOTED_ESCAPE")._changeState(Ct)):(It("Escape sequence is not followed by a quote sequence."),void e._raiseWarning("INVALID_QUOTED_ESCAPE")._push(a)._changeState(Rt));e._push(a)}},quoted_field:function(e){var t,i,r,n,s;return t=e._escapeLastIndex,n=e._escape,i=e._quoteLastIndex,s=e._quote,r=e._doublequote,function(a){if(Wt("Char: %s",a),!1===r&&a===n[t]&&e._scan(n,t))return Wt("Escape."),void e._push(a)._changeState(Ot);if(a===s[i]&&e._scan(s,i))return Wt("Quote."),void e._rewind(i)._changeState(Nt);e._push(a)}},skip:function(e){var t,i,r,n,s,a,o,c,_,u,p,h,d,l;return r=e._commentLastIndex,_=e._comment,a=e._skipLastIndex,l=e._skip,n=e._escapeLastIndex,p=e._escape,s=e._quoteLastIndex,d=e._quote,t=e._delimiterLastIndex,o=e._delimiter,i=e._newlineLastIndex,c=e._newline,u=e._quoting,h=e._strict,function(f){var g=e._cursor+1;if(Vt("Char: %s",f),_&&g-r==0&&f===_[r]&&e._scan(_,r))return Vt("Comment."),void e._push(f)._changeState(jt);if(l&&g-a==0&&f===l[a]&&e._scan(l,a))return Vt("Skip."),void e._push(f)._changeState(At);if(f===p[n]&&e._scan(p,n))return Vt("Escape."),void e._push(f)._changeState(Dt);if(g-s==0&&f===d[s]&&e._scan(d,s))return u?(Vt("Quote."),void e._push(f)._changeState(Pt)):void e._push(f);if(!1===h&&f===d[s]&&e._scan(d,s))return u&&e._isWhitespace(0,e._cursor-s)?(Vt("Quote."),void e._push(f)._changeState(Pt)):void e._push(f);if(f===o[t]&&e._scan(o,t))return Vt("Delimiter."),void e._push(f)._changeState(Tt);if(f===c[i]&&e._scan(c,i))return Vt("Newline."),void e._rewind(i)._changeState(Ft);e._push(f)}},skipped_comment:function(e){var t,i;return t=e._newlineLastIndex,i=e._newline,function(r){if($t("Char: %s",r),r===i[t]&&e._scan(i,t))return $t("Newline."),void e._rewind(t)._changeState(Qt);e._push(r)}},skipped_escape:function(e){var t,i,r,n,s,a,o,c,_,u,p;return t=e._delimiterLastIndex,a=e._delimiter,i=e._newlineLastIndex,o=e._newline,r=e._commentLastIndex,c=e._comment,s=e._skipLastIndex,u=e._skip,n=e._escapeLastIndex,_=e._escape,p=tt(tt(t,i),n),function(h){var d=e._cursor,l=e._eidx,f=d-l;if(Bt("Char: %s",h),f===t&&h===a[t]&&e._scan(a,t))return Bt("Delimiter."),void e._push(h)._changeState(Gt);if(f===i&&h===o[i]&&e._scan(o,i))return Bt("Newline."),void e._push(h)._changeState(Gt);if(f===n&&h===_[n]&&e._scan(_,n))return Bt("Escape."),void e._push(h)._changeState(Gt);if(c&&d-r==0&&h===c[r]&&e._scan(c,r))return Bt("Comment."),void e._push(h)._changeState(Gt);if(u&&d-s==0&&h===u[s]&&e._scan(u,s))return Bt("Skip."),void e._push(h)._changeState(Gt);if(f>=p)return Bt("Normal character sequence."),void e._push(h)._changeState(Gt);e._push(h)}},skipped_field:function(e){var t,i,r,n,s,a,o,c,_,u;return r=e._escapeLastIndex,c=e._escape,n=e._quoteLastIndex,u=e._quote,t=e._delimiterLastIndex,s=e._delimiter,i=e._newlineLastIndex,a=e._newline,o=e._quoting,_=e._strict,function(p){var h=e._cursor-e._cidx+1;if(Ut("Char: %s",p),p===c[r]&&e._scan(c,r))return Ut("Escape."),void e._push(p)._changeState(zt);if(h-n==0&&p===u[n]&&e._scan(u,n))return e._push(p),o?(Ut("Quote."),void e._changeState(Xt)):void 0;if(!1===_&&p===u[n]&&e._scan(u,n))return e._push(p),o&&e._isWhitespace(e._cidx,e._cursor-n)?(Ut("Quote."),void e._changeState(Xt)):void 0;if(p===s[t]&&e._scan(s,t))return Ut("Delimiter."),void e._push(p)._changeState(Mt);if(p===a[i]&&e._scan(a,i))return Ut("Newline."),void e._rewind(i)._changeState(Zt);e._push(p)}},skipped_invalid_quote_end:function(e){var t,i,r,n;return t=e._delimiterLastIndex,r=e._delimiter,i=e._newlineLastIndex,n=e._newline,function(s){if(Ht("Char: %s",s),s===r[t]&&e._scan(r,t))return Ht("Delimiter."),void e._push(s)._changeState(Jt);if(s===n[i]&&e._scan(n,i))return Ht("Newline."),void e._rewind(i)._changeState(Kt);e._push(s)}},skipped_quote_end:function(e){var t,i,r,n,s,a,o,c;return t=e._delimiterLastIndex,s=e._delimiter,i=e._newlineLastIndex,a=e._newline,r=e._quoteLastIndex,o=e._quote,n=e._doublequote,c=tt(tt(t,i),r),function(_){if(Yt("Char: %s",_),n&&_===o[r]&&e._scan(o,r))return Yt("Double quote."),void e._push(_)._changeState(ri);if(_===s[t]&&e._scan(s,t))return Yt("Delimiter."),void e._push(_)._changeState(ti);if(_===a[i]&&e._scan(a,i))return Yt("Newline."),void e._rewind(i)._changeState(ei);if(e._cursor-e._qidx>=c)return Yt("Invalid closing quote."),void e._push(_)._changeState(ii);e._push(_)}},skipped_quoted_escape:function(e){var t,i;return t=e._quoteLastIndex,i=e._quote,function(r){var n=e._cursor,s=e._eidx,a=n-s;if(ni("Char: %s",r),a===t&&r===i[t]&&e._scan(i,t))return ni("Quote."),void e._push(r)._changeState(si);if(a>=t)return ni("Escape sequence is not followed by a quote sequence."),void e._push(r)._changeState(si);e._push(r)}},skipped_quoted_field:function(e){var t,i,r,n,s;return t=e._escapeLastIndex,n=e._escape,i=e._quoteLastIndex,s=e._quote,r=e._doublequote,function(a){if(ai("Char: %s",a),!1===r&&a===n[t]&&e._scan(n,t))return ai("Escape."),void e._push(a)._changeState(ci);if(a===s[i]&&e._scan(s,i))return ai("Quote."),void e._push(a)._changeState(oi);e._push(a)}}};function ui(e){var t,i;for(t=[],i=0;i<Xe.length;i++)t.push(_i[Xe[i]](e));return t}var pi,hi=K("parser"),di=He.closed,li=He.comment,fi=He.error,gi=He.escape,wi=He.field,vi=He.init,mi=He.invalid_quote_end,ki=He.quote_end,bi=He.quoted_escape,yi=He.quoted_field,Si=He.skip;function xi(e){var t,i;for(t="(?:",i=0;i<e.length-1;i++)t+=Ge(e[i])+"|";return t+Ge(e[i])+")"}function qi(e){var t;return this instanceof qi?(e=e||{},t=Me(),this._buffer=[],this._cursor=-1,this._cidx=0,this._qidx=-1,this._eidx=-1,this._rowBufferFLG=ee(e.rowBuffer),this._rowBuffer=e.rowBuffer||t.rowBuffer,this._col=0,this._row=0,this._line=0,this._commented=!1,this._skipped=!1,this._errname="",this._comment=e.comment||t.comment,this._delimiter=e.delimiter||t.delimiter,this._doublequote=void 0===e.doublequote?t.doublequote:e.doublequote,this._escape=e.escape||t.escape,this._ltrim=void 0===e.ltrim?t.ltrim:e.ltrim,this._maxRows=void 0===e.maxRows?t.maxRows:e.maxRows,this._newline=e.newline||t.newline,this._quote=e.quote||t.quote,this._quoting=void 0===e.quoting?t.quoting:e.quoting,this._rtrim=void 0===e.rtrim?t.rtrim:e.rtrim,this._skip=e.skip||t.skip,this._skipBlankRows=void 0===e.skipBlankRows?t.skipBlankRows:e.skipBlankRows,this._skipRow=e.skipRow||t.skipRow,this._strict=void 0===e.strict?t.strict:e.strict,this._trimComment=void 0===e.trimComment?t.trimComment:e.trimComment,this._whitespace=xi(e.whitespace||t.whitespace),this._reWhitespace=new RegExp("^"+this._whitespace+"*([\\S\\s]*?)"+this._whitespace+"*$"),this._reWhitespaceLeft=new RegExp("^"+this._whitespace+"*"),this._reWhitespaceRight=new RegExp(this._whitespace+"*$"),this._onClose=e.onClose||t.onClose,this._onColumn=e.onColumn||t.onColumn,this._onComment=e.onComment||t.onComment,this._onRow=e.onRow||t.onRow,this._onSkip=e.onSkip||t.onSkip,this._onError=e.onError||t.onError,this._onWarn=e.onWarn||t.onWarn,this._commentLength=this._comment.length,this._commentLastIndex=this._commentLength-1,this._delimiterLength=this._delimiter.length,this._delimiterLastIndex=this._delimiterLength-1,this._escapeLength=this._escape.length,this._escapeLastIndex=this._escapeLength-1,this._newlineLength=this._newline.length,this._newlineLastIndex=this._newlineLength-1,this._quoteLength=this._quote.length,this._quoteLastIndex=this._quoteLength-1,this._skipLength=this._skip.length,this._skipLastIndex=this._skipLength-1,this._skipRow&&this._skipRow(0,0)?(this._state=Si,this._skipped=!0):this._state=vi,this._states=ui(this),this):arguments.length?new qi(e):new qi}He.skipped_comment,He.skipped_escape,He.skipped_field,He.skipped_invalid_quote_end,He.skipped_quote_end,He.skipped_quoted_escape,He.skipped_quoted_field,Y(qi.prototype,"_push",(function(e){var t=this._buffer;return this._cursor+=1,this._cursor>=t.length?(t.push(e),hi("Internal buffer size increased. Length: %d.",t.length)):t[this._cursor]=e,hi("Cursor: %d. Push: %s",this._cursor,e),this})),Y(qi.prototype,"_rewind",(function(e){return this._cursor-=e,hi("Rewind: %d. Cursor: %d.",e,this._cursor),this})),Y(qi.prototype,"_copyWithin",(function(e,t,i){var r,n;for(r=this._buffer,n=0;n<i;n++)r[e+n]=r[t+n];return this})),Y(qi.prototype,"_slice",(function(e,t){return this._buffer.slice(e,t+1).join("")})),Y(qi.prototype,"_isWhitespace",(function(e,t){return""===Ue(this._slice(e,t),this._reWhitespaceLeft,"")})),Y(qi.prototype,"_reset",(function(){return this._col=0,this._cidx=0,this._qidx=-1,this._eidx=-1,this._skipRow&&this._skipRow(this._row,this._line)?(this._state=Si,this._skipped=!0):(this._state=vi,this._skipped=!1),this._commented=!1,this._cursor=-1,hi("Parser reset."),this})),Y(qi.prototype,"_setField",(function(e,t){var i=this._rowBuffer;return t>=i.length?(i.push(e),hi("Row buffer size increased. Length: %d.",i.length)):i[t]=e,this})),Y(qi.prototype,"_getField",(function(e,t){var i=this._slice(e,t);return this._ltrim?this._rtrim?Ue(i,this._reWhitespace,"$1"):Ue(i,this._reWhitespaceLeft,""):this._rtrim?Ue(i,this._reWhitespaceRight,""):i})),Y(qi.prototype,"_getRow",(function(){return this._rowBufferFLG?this._rowBuffer:this._rowBuffer.slice(0,this._col)})),Y(qi.prototype,"_scan",(function(e,t){var i,r,n;for(i=this._buffer,r=this._cursor-t+1,n=0;n<t&&i[r+n]===e[n];n++);return n===t})),Y(qi.prototype,"_onField",(function(){var e=this._getField(this._cidx,this._cursor);return this._setField(e,this._col),this._onColumn(e,this._row,this._col,this._line),hi("Field. Line: %d. Row: %d. Column: %d. Value: %s",this._line,this._row,this._col,e),this._col+=1,this._cidx=this._cursor+1,this._qidx=-1,this._eidx=-1,this})),Y(qi.prototype,"_onRecord",(function(){var e;return e=this._getField(this._cidx,this._cursor),!this._skipBlankRows||0!==this._col||""!==e&&""!==Ue(e,this._reWhitespaceLeft,"")?(this._setField(e,this._col),this._onColumn(e,this._row,this._col,this._line),this._col+=1,this._onRow(this._getRow(),this._row,this._col,this._line),hi("Record. Line: %d. Fields: %d.",this._line,this._col),this._row+=1,this._line+=1,this._reset(),this._row>=this._maxRows&&this._changeState(di),this):this._onSkippedRow()})),Y(qi.prototype,"_onCommentedRow",(function(){var e;return this._onComment?(e=this._slice(0,this._cursor),this._trimComment&&(e=Ue(e,this._reWhitespaceLeft,"")),this._onComment(e,this._line),hi("Comment. Line: %d. Value: %s",this._line,e)):hi("Comment. Line: %d.",this._line),this._line+=1,this._reset(),this})),Y(qi.prototype,"_onSkippedRow",(function(){var e;return this._onSkip?(e=this._slice(0,this._cursor),this._onSkip(e,this._line),hi("Skipped row. Line: %d. Value: %s",this._line,e)):hi("Skipped row. Line: %d.",this._line),this._line+=1,this._reset(),this})),Y(qi.prototype,"_onClosingQuote",(function(){return this._qidx=this._cursor,this})),Y(qi.prototype,"_onEscape",(function(){return this._eidx=this._cursor,this})),Y(qi.prototype,"_createException",(function(e){var t;switch(e){case"INVALID_CLOSING_QUOTE":t=new Error(We("unexpected error. Encountered an invalid record. Field %d on line %d contains a closing quote which is not immediately followed by a delimiter or newline.",this._col,this._line));break;case"INVALID_OPENING_QUOTE":t=new Error(We("unexpected error. Encountered an invalid record. Field %d on line %d contains an opening quote which does not immediately follow a delimiter or newline.",this._col,this._line));break;case"INVALID_ESCAPE":t=new Error(We("unexpected error. Encountered an invalid record. Field %d on line %d contains an escape sequence which is not immediately followed by a special character sequence.",this._col,this._line));break;case"INVALID_QUOTED_ESCAPE":t=new Error(We("unexpected error. Encountered an invalid record. Field %d on line %d contains an escape sequence within a quoted field which is not immediately followed by a quote sequence.",this._col,this._line));break;case"CLOSED":t=new Error("invalid operation. Parser is unable to parse new chunks, as the parser has been closed. To parse new chunks, create a new parser instance.");break;default:t=new Error("invalid operation. Parser is in an unrecoverable error state. To parse new chunks, create a new parser instance.")}return t})),Y(qi.prototype,"_raiseWarning",(function(e){var t;return this._onWarn&&(t=this._createException(e),hi("Warning: %s",t.message),this._onWarn(t)),this})),Y(qi.prototype,"_raiseException",(function(){var e=this._createException(this._errname);return hi("Error: %s",e.message),this._onError(e),this})),Y(qi.prototype,"_changeState",(function(e){switch(hi("State transition: %s -> %s.",Xe[this._state],Xe[e]),e){case di:this._close();break;case li:this._commented=!0;break;case fi:this._raiseException();break;case gi:this._onEscape();break;case wi:this._state!==gi&&this._onField();break;case vi:this._commented?this._onCommentedRow():this._skipped?this._onSkippedRow():this._onRecord();break;case mi:break;case ki:this._onClosingQuote();break;case bi:this._onEscape();break;case yi:break;case Si:this._skipped=!0}return this._state=e,this})),Y(qi.prototype,"_setErrorState",(function(e){return e?hi("Error: %s.",e):hi("Reset error state."),this._errname=e,this})),Y(qi.prototype,"_close",(function(){var e,t;return this.done?(this._setErrorState(di)._changeState(fi),this):(this._cursor>=0?(e=this._state)===vi||e===wi||e===ki?this._changeState(vi)._onClose():(this._col&&this._onRow(this._getRow(),this._row,this._col),t=this._slice(this._cidx,this._cursor),hi("Flush: %s",t),this._onClose(t)):this._onClose(),hi("Closed."),this)})),Y(qi.prototype,"next",(function(e){var t,i;if(hi("Chunk: %s",e),this.done)return this._setErrorState(di)._changeState(fi),this;for(t=this._states,i=0;i<e.length;i++)if(t[this._state](e[i]),this._state===di||this._state===fi)return this;return this})),Y(qi.prototype,"close",(function(){return this.done||this._changeState(di),this})),pi=qi.prototype,H(pi,"done",{configurable:!1,enumerable:!1,get:function(){return this._state===di||this._state===fi}});var Ei={};!function(e,t,i){H(e,t,{configurable:!1,enumerable:!0,writable:!1,value:i})}(Ei,"parse",qi);var Li={};!function(e,t,i){P(e,t,{configurable:!1,enumerable:!0,writable:!1,value:i})}(Li,"base",Ei);export{Ei as base,Li as default};
//# sourceMappingURL=mod.js.map
